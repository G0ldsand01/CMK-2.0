---
import { actions } from 'astro:actions';
import DashboardLayout from '@/layouts/DashboardLayout.astro';
import { getCurrentUser } from '@/lib/auth-server';
import WishlistManager from '@/components/wishlist/WishlistManager';

const user = await getCurrentUser(Astro.request);

if (!user) {
  return Astro.redirect('/login');
}

const action = await Astro.callAction(actions.user.getWishlist, {});
const data = action.data;

if (!data) {
  return Astro.redirect('/dashboard/');
}

const wishlist = data.wishlist ?? [];
---

<DashboardLayout
  title="Wishlist"
  breadcrumb={{
    '/wishlist': 'Wishlist',
  }}
>
  <div class="space-y-6 p-6">
    <div class="space-y-2">
      <h1 class="text-3xl font-bold tracking-tight">My Wishlist</h1>
      <p class="text-muted-foreground">
        Save your favorite products for later
      </p>
    </div>

    <WishlistManager wishlist={JSON.parse(JSON.stringify(wishlist))} client:load />
  </div>
</DashboardLayout>
