---
import { CategoriesTable } from '@/components/admin/categories/CategoriesTable';
import { productCategoryTable } from '@/db/schema';
import AdminDashboardLayout from '@/layouts/AdminDashboardLayout.astro';
import { getCurrentUser } from '@/lib/auth-server';
import db from '@/lib/db';

const user = await getCurrentUser(Astro.request);

if (!user || user.role !== 'admin') {
  return Astro.redirect('/dashboard');
}

const categories = await db.select().from(productCategoryTable);
---

<AdminDashboardLayout
  title="Manage Categories"
  breadcrumb={{
    '/categories': 'Manage Categories',
  }}
>
  <div class="space-y-6 p-6">
    <div class="space-y-2">
      <h1 class="text-3xl font-bold tracking-tight">Manage Categories</h1>
      <p class="text-muted-foreground text-lg">
        Organize your products by creating and managing categories
      </p>
    </div>

    <CategoriesTable client:load initialCategories={categories} />
  </div>
</AdminDashboardLayout>
