---
import DashboardLayout from '@/layouts/DashboardLayout.astro';
import { getUser } from '@/lib/user';
const user = await getUser(Astro.request);

if (!user || !user.isAdmin()) {
  return Astro.redirect('/dashboard');
}
if (user.isAdmin()) {
  return Astro.redirect('/admindashboard');
}
---

<DashboardLayout title="Add New Products" activeId="newproducts">
  <div class="content">
    <div class="head">
      <div class="welcome-message">
        <h1>Add New Products</h1>
        <p>Manage your account settings</p>
      </div>
    </div>

    <form>
      <label for="name">Product Name:</label>
      <input type="text" name="name" id="name" class="inputs" required />
      
      <label for="price">Price:</label>
      <input type="number" name="price" id="price" class="inputs" required />
      
      <label for="description">Description:</label>
      <textarea name="description" id="description" class="inputs" required></textarea>
      
      <label for="image">Image URL:</label>
      <input type="text" name="image" id="image" class="inputs" required />
      
      <label for="category">Category:</label>
      <select name="category" id="category" class="inputs" required>
        <option value="electronics">Electronics</option>
        <option value="clothing">Clothing</option>
        <option value="accessories">Accessories</option>
        <option value="toys">Toys</option>
        <option value="home">Home</option>
        <option value="beauty">Beauty</option>
        <option value="grocery">Grocery</option>
      </select>
      
      <label for="stock">Stock:</label>
      <input type="number" name="stock" id="stock" class="inputs" required />
      
      <label for="sku">ID:</label>
      <input type="text" name="id" id="id" class="inputs" required />
      
      <button type="submit">Add Product</button>
    </form>
  </div>
</DashboardLayout>

<script>
  import { actions } from 'astro:actions';

  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector("form");
    form?.addEventListener("submit", async (event) => {
      event.preventDefault();
      const formData = new FormData(form);
      const highestId = await actions.products.getHighestId();
      const { error } = await actions.products.addProduct({
        name: formData.get("name"),
        price: Number(formData.get("price")),
        description: formData.get("description"),
        image: formData.get("image"),
        category: formData.get("category"),
        stock: formData.get("stock") ? Number(formData.get("stock")) : 0,
        id: formData.get("id") ? Number(formData.get("id")) : highestId.data ? highestId.data + 1 : 1,
      });
      if (!error) {
        alert("Product added successfully");
      } else {
        alert("Error adding product");
      }
      form.reset();
    });
  });
</script>

<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #0f0f0f;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .head {
    background-color: rgba(255, 255, 255, 0.1);
    color: #27ae60;
    padding: 1.5rem;
    border-radius: 10px;
    text-align: center;
    margin-bottom: 1.5rem;
    margin-top: 5rem;
  }

  form {
    background-color: #1e1e1e;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  label {
    color: #fff;
    font-weight: bold;
  }

  .inputs {
    width: 100%;
    padding: 12px;
    border: 2px solid #27ae60;
    border-radius: 8px;
    background-color: #121212;
    color: #ecf0f1;
    outline: none;
  }

  button[type="submit"] {
    background-color: #27ae60;
    color: #fff;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    width: 100%;
  }

  @media (max-width: 768px) {
    .content {
      max-width: 100%;
    }
  }
</style>
