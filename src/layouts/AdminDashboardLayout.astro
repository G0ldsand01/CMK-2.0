---
import Layout from './Layout.astro';
import '@/styles/global.css';
import { AdminSidebar } from '@/components/AdminSidebar';
import { getCurrentUser } from '@/lib/auth-server';

interface Props {
  title: string;
  breadcrumb: Record<string, string>;
}

const { title, breadcrumb } = Astro.props;
const user = await getCurrentUser(Astro.request as Request);

if (!user || user.role !== 'admin') {
  return Astro.redirect('/dashboard');
}

const userData = {
  id: user.id,
  name: user.name,
  email: user.email,
  image: user.image || '',
  role: user.role,
};
---

<Layout title={title} navbar={false}>
  <AdminSidebar userData={userData} breadcrumb={breadcrumb} client:load>
    <slot />
  </AdminSidebar>
</Layout>

<style>
  html,
  body {
    min-height: 100vh;
    font-family: 'Arial', sans-serif;
  }

  .sidebar {
    background-color: var(--color-sidebar);
  }
</style>
