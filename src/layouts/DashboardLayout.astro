---
import Layout from './Layout.astro';
import '@/styles/global.css';
import { DashboardSidebar } from '@/components/DashboardSidebar';
import { authServer } from '@/lib/auth-server';

interface Props {
  title: string;
  breadcrumb: Record<string, string>;
}

const { title, breadcrumb } = Astro.props;
const session = await authServer.api.getSession({
  headers: Astro.request.headers,
});

const user = session?.user;

if (!user) {
  return Astro.redirect('/login');
}

const userData = {
  id: user.id,
  name: user.name,
  email: user.email,
  image: user.image || '',
  role: user.role,
};
---

<Layout title={title} navbar={false}>
  <DashboardSidebar
    userData={userData}
    breadcrumb={breadcrumb}
    client:only="react"
  >
    <slot />
  </DashboardSidebar>
</Layout>

<style>
  html,
  body {
    min-height: 100vh;
    font-family: 'Arial', sans-serif;
  }
</style>
